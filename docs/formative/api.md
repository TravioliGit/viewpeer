# AppEng 2020

## Peer Review Web App

Below is information about the API to be designed and used in PeerView (name too easy?)

The API will use two protocols for data transfer: HTTP and Websockets. These will be essential in creating the website. HTTP will be used for requests where latency is a non-issue, such as posting a publication to the server, saving user account information and creating a cohort. Websockets will be used where low-latency tasks are required, such as reviewing papers, rating said reviews, and when using a chat window. All requests will route through `routes.js` using predefined terms, and the data will be sent to/retrieved from `query.js`. 

## HTTP Routes

HTTP requests will be used for larger data transfers where latency is of low concern. Instances this is planned for usage in so far include adding a publication, making a review, retrieving account information, creating a cohort. Routes may include, but are subject to change/are not limited to:

* `/routes/publish`
  - GET: retrieves a publication and ancillary data by its id. returns error if no match. will return JSON object of relevant data.
  - PUT: overwrites publication ancillary data, such as title and (if given) external link.
  - POST: adds a publication to the `publish` folder, posts path reference to database if pdf. generates id. will send JSON object of ancillary data, such as external link if provided.
  - DELETE: will remove publication by id.

* `/routes/user`
  - GET: retrieves user data by its id. performed after successful login check. will return JSON object of relevant user data.
  - PUT: overwrites user data by accepting data from "edit account" form. 
  - POST: creates a new user profile using given credentials. generates id
  - DELETE: will remove user account by id.

* `/routes/login`
  - GET: retrieves data to check if provided credentials match user on database. returns error if no match.

* `/routes/review`
  - GET: retrieves 15 most recent reviews on a publication (retrieved by id), and any related comment threads. will return JSON array.
  - PUT: will overwrite review content, given an object containing string and id.  
  - POST: will add review to publication. given object of data gathered from page. generates id.

* `/routes/comment`
  - GET: retrieves 15 earliest comments on a review (retrieved by id). will return JSON array.
  - PUT: will overwrite comment content, given an object containing string and id.  
  - POST: will add comment to review, given object of data gathered from page. generates id.

* `/routes/cohort`
  - GET: retrieves information about cohort given an id. will return json object.
  - PUT: allows cohort members to edit information of cohort given id. will send json object.
  - POST: creates new cohort. id generated on request, data sent as json object.
  - DELETE: removes cohort by id. 

* `/routes/message`
  - POST: will send a message to the server and account (given by id) in question. if cohort id is provided, will send to group chat. sent as json object containing message content and ids. message id generated by database.

* `/routes/invite`
  - POST: will send an invite to a user to join a cohort. given cohort id and user id. 
  
## Web Socket Routes

The websocket will be used for (relatively) smaller data transfers where low-latency is preferable. Instances this is planned for usage in so far include retrieving chat messages, a "user is typing" preview in the chat function, posting a comment on a review, invites to cohorts. Routes listed below are subject to change/are not limited to the list. The websocket will be opened when connecting to the app.

### Messaging

* When a user opens a chat screen (user, cohort), the server will send the most recent 30 messages to the user:
```js
{
  type: 'getmessage',
  messages: // array of messages; JSON objects
}
```
* When a chat message is sent to the server by a user (HTTP POST), the server will return the message and add it to the relevant chat:
```js
{
  type: 'message',
  message: // message object
}
```
* When a user is typing a message into a chat window, a message will be sent to the server to update any connected/relevant users:
```js
{
  type: 'typing'
}
```

### Cohort Invitation

* When a client invites another user to a cohort (HTTP Post), it will send this message to the server to update the user in question:
```js
{
  type: 'invite',
  invite: // object containing cohort info
}
```
* When a client reponds to an invitation, it will relay this to the server with the response, and send the response to the inviting user:
```js
{
  type: 'inviteresp',
  response: // object containing response info
}
```

### Reviews

* When a client posts a review (that contains text)(HTTP post), a message will be sent to the server to notify all connected clients and update the page. will update publisher that a review has been posted:
```js
{
  type: 'review'
  comment: // object containing review information
}
```

### Comments

* When a client posts a comment on a review (HTTP post), a message will be sent to the server to notify all connected clients and update the page. will update reviewer that comment has been posted:
```js
{
  type: 'comment'
  comment: // object containing comment information
}
```